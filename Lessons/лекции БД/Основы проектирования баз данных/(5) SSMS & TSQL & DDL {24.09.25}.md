# SQL
## Характеристика:
- Язык: *T-SQL* (транзакт)
- Сервак-СУБД: *SQL Server*
- Прога: *SSMS*
#### **Скрипт**- набора запросов.
#### **Запрос** - конкретная команда.
#### **GO** - команда, используемой для разделения набора SQL-запросов, на отдельные блоки.

# DDL — Data Definition Language.
**Язык описания данных.**
*Команды DDL позволяют создавать, изменять и удалять объекты БД.*
### Основные операторы DDL:  
- *CREATE* - создает новые БД, схемы, таблицы и другие объекты БД.
- *ALTER* - Изменяет объекты БД. Например, в таблицах этот оператор может добавлять и удалять столбцы, а так же изменять их тип.
- *DROP* - Удаляет любые объекты БД, может и саму БД.
- *C.R.U.D.* - аббревиатура, обозначающая 4 основные операции, которые можно выполнить с данными.


# DML — Data Manipulation Language.
##### **DML — язык манипулирования данными. Команды DML позволяют изменять данные, хранящиеся в таблицах.**
### Основные операторы DML:  
#### *INSERT* — вставляет новые строки данных в таблицу.  
![[Pasted image 20251018084825.png]]

1. Можно прописать SELECT для вывода таблицы.
![[Pasted image 20251018084936.png]]

2. Показ таблицы `SELECT * FROM название таблички`:
![[Pasted image 20251018085424.png]]

3. Двойной внос данных:
![[Pasted image 20251018085812.png]]
![[Pasted image 20251018090051.png]]

4. Расстановка на айдишник таблицы positions;
![[Pasted image 20251018090603.png]]
![[Pasted image 20251018090741.png]]

5. Таблица паспорта:
![[Pasted image 20251018091354.png]]

6. Таблица клиентов:
![[Pasted image 20251018092156.png]]
![[Pasted image 20251018092209.png]]

7. Таблица заказов ***(DEFAULT по таблице 0, можно писать если значенися большие)***:
![[Pasted image 20251018092927.png]]
![[Pasted image 20251018092954.png]]



#### *UPDATE* — обновляет существующие данные в таблице. 
![[Pasted image 20251018093805.png]]
![[Pasted image 20251018093741.png]]

1. Двойное изменение и условие:
![[Pasted image 20251018094052.png]]



#### *DELETE* — удаляет строки данных из таблицы.
**Если строка вызывается в другой таблице нужно сперва удалить инфу в другой таблице, а потом удалять строки в основной таблице.**
![[Pasted image 20251018094532.png]]

1. Удаление всех строк:
![[Pasted image 20251018094959.png]]



#### *ALTER* - Изменяет объекты БД. Например, в таблицах этот оператор может добавлять и удалять столбцы, а так же изменять их тип.
![[Pasted image 20251018102702.png]]
**Можно писать NOT NULL и UNIQUE ТОЛЬКО если таблица вся пустая.**

1. Пример нормальной записи:
![[Pasted image 20251018103105.png]]
![[Pasted image 20251018103121.png]]

2. Заполняем пустые значения с помощью UPDATE:
![[Pasted image 20251018103316.png]]


3. Изменяем столбец почты на стандарт NOT NULL, поэтому юзаем ALTER ***(COLUMN-Столбец)***:
![[Pasted image 20251018103748.png]]

4. Добавляем в столбец UNIQUE ***(UNIQUE, все остальные ключи тд добавляются с помощью ограничений по схеме `ADD CONSTRAINT <название ключа> UNIQUE(<столбец>)`)***:
![[Pasted image 20251018104418.png]]

5. Удаление колонки с помощью DROP. НО сперва снимаем ограничения по типу UNIQUE ***(COLUMN-Столбец)***:
 a) Снятие ограничений `DROP CONSTRAINT <название ключа>`:
![[Pasted image 20251018104920.png]]
b) Удаление колонки:
![[Pasted image 20251018104628.png]]

7. Создание и ссылка по FK на столбец с помощью ALTER ***(2 способа)***:
![[Pasted image 20251018105640.png]]

7. Добавление ограничений CHECK и DEFAULT с помощью ALTER:
![[Pasted image 20251018110120.png]]

8. Удаление PK с помощью ALTER (***Перетащить из Обозревателя объектов***) (**Удалить сперва ограничения**):
![[Pasted image 20251018111110.png]]

9. Добавление PK:
![[Pasted image 20251018111601.png]]



#### *EXEC* - Встроенная процедура.
###### Схема EXEC:
`EXEC sp_rename '<Таблица.столбец>', '<во что переименовать>', 'COLUMN';`

1. Переименовка столбца с помощью ALTER (**Перед этим избавится от ограничений**):
![[Pasted image 20251018110543.png]]

2. Переименовка таблицы с помощью ALTER (**Ограничения можно не снимать**):
![[Pasted image 20251018111841.png]]




# DQL — Data Query Language.
##### **Язык запроса данных.  Команды DQL позволяют извлекать данные из БД.**

### Основные операторы DQL:
#### *SELECT* - Извлекает данные из БД.
1. Определенные столбцы
![[Pasted image 20251025105020.png]]
![[Pasted image 20251025105105.png]]

2. Вывод определенных строк:
![[Pasted image 20251025105623.png]]

3. Диапазон:
![[Pasted image 20251025105826.png]]

4. Оператор `LIKE '%'` (где после процента идет поиск, написать люблю букву и пойдет поиск, если % стоит после буквы, то буква и любые символы) `LIKE '_P'` (какой-то 1 символ и потом Р. Нижнее подчеркивание это какой-то символ):
![[Pasted image 20251025110443.png]]

5. Оператор `ORDER BY <столбец> ASC` (*ASC* - От А до Я, *DESC* - От Я до А (с цифрами так же)):
![[Pasted image 20251025111114.png]]

6. Оператор `COUNT(*)`  считает кол-во. `(*)` - все значения. Можно дать псевдоним столбцу `COUNT(*) AS 'Кол-во сотрудников'`:
![[Pasted image 20251025111455.png]]

7. Сортируем похожие и считаем кол-во:
![[Pasted image 20251025112004.png]]
![[Pasted image 20251025112153.png]]

8. Команда `TOP` - выводит топ 2 первые строки:
![[Pasted image 20251025112628.png]]

9. Команда `CONCAT()` - Группирует столбцы:
![[Pasted image 20251025113042.png]]

10. Команда `LEFT(<что-то>, 3)` - Выводит первые буквы слева, так- же с `RIGHT()`:
![[Pasted image 20251025113218.png]]

11. Вывод инициалов:
![[Pasted image 20251025113622.png]]


#### *GROUP BY*  - Группирует одинаковые значения, считает кол-во одинаковых значений.


#### *JOIN* - Чтобы соединить 2 таблицы с помощью сопоставления строк, нужно прописать условие их соединения.
##### **Условия**:
###### *INNER JOIN* - Соединение по внутр области, общей для 2-х таблиц.
![[Pasted image 20251030141450.png]]

###### *LEFT JOIN* - выводит всю инфу из левой таблицы, не обращая внимания на то, есть ли инфа в правой. 
![[Pasted image 20251030142042.png]]

###### *RIGHT JOIN* - выводит всю инфу из правой таблицы, не обращая внимания на то, есть ли инфа в левой.

###### *FULL JOIN* - Выводит всю инфу из 2-х таблиц.
![[Pasted image 20251030142910.png]]

###### *CROSS JOIN* - Выводит все возможные комбинации из 2-х таблиц.
**(выводит неправду)**
![[Pasted image 20251030143102.png]]

***Пример подключения всех других таблиц:***
1. Подключаем к таблице Заказы другие таблицы Доставка, Клиенты и др
![[Pasted image 20251030143936.png]]
2. Подключаем к шаблону таблицу Должность через таблицу Сотрудники:
![[Pasted image 20251030144808.png]]

#### *UNION* - Сложно

#### *HAVING*  - Сложно



# DCL — Data Control Language
##### **Язык управление доступом к данным.**

## Основные операторы DCL:
### *GRANT* - Предоставляет права доступа к БД и её объектам.
### *REVOKE* - Убирает права доступа.
##### Нужны для: [[(10) Пользователи {13.11.25}]]




# TCL — Transaction Control Language
##### **Язык управления транзакциями.**
**Транзакция в БД**  - Последовательность 1 или не скольких операций (таких как чтение, запись, и обновление или удаление), выполняемых как единая логическая единица работы.
## Основные операторы TCL:
### *COMMIT* - Подтверждает текущую транзакцию и сохраняет изменения в БД.
### *ROLLBACK* - Откатывает текущую транзакцию и отменяет все несохраненные изменения. 
### *SAVEPOINT* - Создает точку сохранения в текущей транзакции, для возможности частичного отката.


1. Создадим таблицу:
![[Pasted image 20251115104720.png]]
2. Создадим таблицу 2 (создание FK на одной строке с привязкой):
![[Pasted image 20251115105055.png]]

3.  Заполнение данными таблицы:
![[Pasted image 20251115105404.png]]

4. Вывод таблиц:
![[Pasted image 20251115105601.png]]

5. Начало транзакции (**Транзакция должна быть завершена** - Либо *ROLLBACK* либо *SAVEPOINT*):
![[Pasted image 20251115105726.png]]

6. Вывод изначальной таблицы, изменение через транзакцию, вывод новой и откат, вывод изначальной:
![[Pasted image 20251115105906.png]]

7. Перевод денег Алины на счёт Ивана:
![[Pasted image 20251115111241.png]]

8. Итоги работы транзакции:
![[Pasted image 20251115111130.png]]


#### Работа с *SAVEPOINT* (*SAVE TRANSACTION*):
![[Pasted image 20251115113020.png]]

**Зачем нужен коммит при откате?** - Транзакция не завершена будет и невозможно будет работать
![[Pasted image 20251115113236.png]]


